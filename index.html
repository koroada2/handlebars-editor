<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고급 Handlebars 에디터</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/ext-language_tools.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/mode-handlebars.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/theme-monokai.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/theme-twilight.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/theme-dracula.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/theme-tomorrow_night.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/worker-html.js"></script>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --header-bg: #646cff;
            --sidebar-bg: #252526;
            --button-bg: #3e3e42;
            --button-hover: #4b4b4f;
            --font-color: #d4d4d4;
            --line-number-color: #858585;
            --active-line-bg: #264f78;
            --border-color: #3e3e42;
            --dropdown-bg: #2d2d2d;
            --dropdown-hover: #3e3e3e;
            --dropdown-border: #505050;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --modal-bg: #2a2a2a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Monaco', 'Andale Mono', monospace;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--font-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .top-bar {
            display: flex;
            height: 40px;
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            padding: 0 10px;
            z-index: 100;
        }
        
        .hamburger-menu {
            display: inline-flex;
            flex-direction: column;
            justify-content: space-between;
            height: 16px;
            width: 20px;
            cursor: pointer;
            margin-right: 15px;
            position: relative;
        }
        
        .hamburger-menu span {
            display: block;
            height: 2px;
            width: 100%;
            background-color: var(--font-color);
        }
        
        .tab {
            background-color: var(--sidebar-bg);
            color: var(--font-color);
            padding: 0 15px;
            height: 40px;
            display: flex;
            align-items: center;
            border-right: 1px solid var(--border-color);
        }
        
        .new-tab {
            background-color: var(--header-bg);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            margin-left: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .new-tab:hover {
            opacity: 0.9;
        }
        
        .actions {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }
        
        .action-button {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .action-button:hover {
            background-color: var(--button-hover);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 40px;
            background-color: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
            border-right: 1px solid var(--border-color);
            z-index: 50;
        }
        
        .sidebar-icon {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            border-left: 2px solid transparent;
        }
        
        .sidebar-icon:hover, .sidebar-icon.active {
            border-left: 2px solid var(--header-bg);
        }
        
        .sidebar-icon svg {
            width: 18px;
            height: 18px;
            fill: var(--font-color);
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            overflow: hidden;
        }
        
        .editor-header {
            padding: 10px;
            background-color: var(--header-bg);
            display: flex;
            justify-content: space-between;
        }

        .editor-header button {
            padding: 5px 10px;
            background-color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .tab-bar {
            display: flex;
            height: 40px;
            background-color: var(--sidebar-bg);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }
        
        .editor-tab {
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            border-right: 1px solid var(--border-color);
            min-width: 120px;
            max-width: 180px;
            height: 40px;
            position: relative;
            user-select: none;
        }
        
        .editor-tab.active {
            background-color: var(--bg-color);
        }
        
        .editor-tab .close-tab {
            margin-left: 10px;
            opacity: 0.6;
            font-size: 16px;
        }
        
        .editor-tab .close-tab:hover {
            opacity: 1;
        }
        
        .editor-tab .tab-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .create-tab {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .editor-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .code-editor {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            font-size: 14px;
        }
        
        .preview-panel {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            overflow: auto;
            padding: 10px;
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--font-color);
        }
        
        /* 검색 패널 */
        .search-panel {
            position: absolute;
            top: 0;
            right: 10px;
            background-color: var(--dropdown-bg);
            border: 1px solid var(--dropdown-border);
            border-radius: 4px;
            padding: 10px;
            display: none;
            z-index: 10;
            flex-direction: column;
            gap: 8px;
            min-width: 300px;
        }
        
        .search-panel.active {
            display: flex;
        }
        
        .search-input-group {
            display: flex;
            gap: 5px;
        }
        
        .search-input-group input {
            flex: 1;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 5px;
            color: var(--font-color);
            border-radius: 3px;
        }
        
        .search-actions {
            display: flex;
            gap: 5px;
            justify-content: space-between;
        }
        
        .search-actions button {
            background-color: var(--button-bg);
            border: none;
            color: var(--font-color);
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .search-actions button:hover {
            background-color: var(--button-hover);
        }
        
        .search-options {
            display: flex;
            gap: 10px;
        }
        
        .search-option {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        /* 설정 메뉴 */
        .settings-menu {
            position: absolute;
            top: 40px;
            left: 40px;
            width: 250px;
            background-color: var(--dropdown-bg);
            border: 1px solid var(--dropdown-border);
            border-radius: 4px;
            padding: 10px;
            z-index: 100;
            display: none;
        }
        
        .settings-menu.active {
            display: block;
        }
        
        .settings-menu h3 {
            margin-bottom: 10px;
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .settings-group {
            margin-bottom: 15px;
        }
        
        .settings-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .settings-group select, .settings-group input {
            width: 100%;
            padding: 5px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--font-color);
            border-radius: 3px;
        }
        
        /* 단축키 도움말 */
        .keyboard-shortcuts {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--modal-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            z-index: 200;
            width: 500px;
            max-width: 90%;
            max-height: 80%;
            overflow: auto;
            display: none;
        }
        
        .keyboard-shortcuts.active {
            display: block;
        }
        
        .keyboard-shortcuts h2 {
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .shortcut-group {
            margin-bottom: 15px;
        }
        
        .shortcut-group h3 {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .key {
            background-color: var(--button-bg);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 18px;
            color: var(--font-color);
        }
        
        /* 알림 */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 4px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        .notification.error {
            background-color: var(--error-color);
        }
        
        .notification.active {
            opacity: 1;
        }
        
        /* 상태 표시줄 */
        .status-bar {
            height: 25px;
            background-color: var(--sidebar-bg);
            display: flex;
            align-items: center;
            padding: 0 10px;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
        }
        
        .status-item {
            margin-right: 15px;
        }
        
        .status-right {
            margin-left: auto;
            display: flex;
            gap: 15px;
        }
        
        /* 파일 관리 모달 */
        .file-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--modal-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            z-index: 200;
            width: 500px;
            max-width: 90%;
            display: none;
        }
        
        .file-modal.active {
            display: block;
        }
        
        .file-modal h2 {
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        .file-input label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .file-input input {
            width: 100%;
            padding: 8px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--font-color);
            border-radius: 3px;
        }
        
        .file-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .file-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .file-actions .cancel {
            background-color: var(--button-bg);
            color: var(--font-color);
        }
        
        .file-actions .save {
            background-color: var(--header-bg);
            color: white;
        }
        
        /* 저장된 파일 목록 */
        .saved-files {
            margin-top: 15px;
            max-height: 200px;
            overflow: auto;
        }
        
        .saved-files h3 {
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 8px;
            background-color: var(--bg-color);
            border-radius: 3px;
        }
        
        .file-item:hover {
            background-color: var(--dropdown-hover);
        }
        
        .file-name {
            cursor: pointer;
        }
        
        .file-actions-small {
            display: flex;
            gap: 10px;
        }
        
        .file-action {
            cursor: pointer;
            opacity: 0.7;
        }
        
        .file-action:hover {
            opacity: 1;
        }
        
        /* 미니맵 스타일 */
        .minimap {
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100%;
            border-left: 1px solid var(--border-color);
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* 토글 스위치 */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--button-bg);
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--header-bg);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(18px);
        }
        
        /* 로딩 스피너 */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--header-bg);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 드롭다운 메뉴 */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--dropdown-bg);
            min-width: 160px;
            z-index: 100;
            border: 1px solid var(--dropdown-border);
            border-radius: 3px;
        }
        
        .dropdown-content.active {
            display: block;
        }
        
        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
        }
        
        .dropdown-item:hover {
            background-color: var(--dropdown-hover);
        }
        
        .dropdown-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 5px 0;
        }
        
        /* 자동 완성 */
        .autocomplete {
            position: absolute;
            background-color: var(--dropdown-bg);
            border: 1px solid var(--dropdown-border);
            border-radius: 3px;
            z-index: 100;
            max-height: 200px;
            overflow: auto;
            display: none;
        }
        
        .autocomplete.active {
            display: block;
        }
        
        .autocomplete-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .autocomplete-item:hover, .autocomplete-item.selected {
            background-color: var(--dropdown-hover);
        }
        
        /* 화면 분할 핸들 */
        .resizer {
            width: 6px;
            background-color: var(--border-color);
            cursor: col-resize;
            z-index: 1;
        }
        
        .resizer:hover {
            background-color: var(--header-bg);
        }
        
        /* 추가 에디터 스타일 */
        .ace_editor {
            background-color: var(--bg-color) !important;
        }
        
        .ace_gutter {
            background-color: var(--sidebar-bg) !important;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="hamburger-menu" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="tab file-name-display">Untitled</div>
        <div class="new-tab" id="saveButton">
            <span>저장</span>
        </div>
        <div class="actions">
            <div class="action-button" id="searchButton" title="검색 (Ctrl+F)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.57-5.73A6.5 6.5 0 1 0 10 14.25a6.5 6.5 0 0 0 5.73-1.57l.27.28v.79l5 4.99L22.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
            </div>
            <div class="action-button" id="settingsButton" title="설정">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.38-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.38.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                </svg>
            </div>
            <div class="action-button" id="helpButton" title="단축키">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor" d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
                </svg>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="sidebar">
            <div class="sidebar-icon active" title="에디터">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                </svg>
            </div>
            <div class="sidebar-icon" id="fileManagerButton" title="파일 관리">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10z"/>
                </svg>
            </div>
            <div class="sidebar-icon" id="splitViewButton" title="분할 보기">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M3 19h18v-6H3v6zm0-8h18V5H3v6z"/>
                </svg>
            </div>
            <div class="sidebar-icon" id="minimapToggle" title="미니맵">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M3 3v18h18V3H3zm16 16H5V5h14v14zM11 7h2v2h-2zM7 7h2v2H7zm8 0h2v2h-2zm-8 4h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2zm-8 4h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                </svg>
            </div>
        </div>

        <div class="editor-container">
            <div class="editor-section" style="flex: 1;">
                <div class="tab-bar">
                    <div class="editor-tab active">
                        <span class="tab-title">main.hbs</span>
                        <span class="close-tab">×</span>
                    </div>
                    <div class="create-tab" title="새 파일">+</div>
                </div>
                <div class="editor-wrapper">
                    <div id="editor" class="code-editor"></div>
                    <!-- 검색 패널 -->
                    <div class="search-panel">
                        <div class="search-input-group">
                            <input type="text" id="searchInput" placeholder="검색어">
                            <input type="text" id="replaceInput" placeholder="바꿀 텍스트">
                        </div>
                        <div class="search-actions">
                            <div class="search-options">
                                <div class="search-option">
                                    <input type="checkbox" id="caseSensitive">
                                    <label for="caseSensitive">대소문자 구분</label>
                                </div>
                                <div class="search-option">
                                    <input type="checkbox" id="wholeWord">
                                    <label for="wholeWord">단어 단위</label>
                                </div>
                                <div class="search-option">
                                    <input type="checkbox" id="regExp">
                                    <label for="regExp">정규식</label>
                                </div>
                            </div>
                            <div>
                                <button id="findButton">찾기</button>
                                <button id="replaceButton">바꾸기</button>
                                <button id="replaceAllButton">모두 바꾸기</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="previewSection" class="editor-section" style="display: none; flex: 1;">
                <div class="tab-bar">
                    <div class="editor-tab active">
                        <span class="tab-title">미리보기</span>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div id="preview" class="preview-panel"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-item" id="cursor-position">줄: 1, 열: 1</div>
        <div class="status-item" id="file-type">Handlebars</div>
        <div class="status-right">
            <div class="status-item" id="indent-size">들여쓰기: 2</div>
            <div class="status-item" id="encoding">UTF-8</div>
        </div>
    </div>
    
    <!-- 설정 메뉴 -->
    <div class="settings-menu">
        <h3>에디터 설정</h3>
        <div class="settings-group">
            <label for="themeSelect">테마</label>
            <select id="themeSelect">
                <option value="monokai">Monokai</option>
                <option value="twilight">Twilight</option>
                <option value="dracula">Dracula</option>
                <option value="tomorrow_night">Tomorrow Night</option>
            </select>
        </div>
        <div class="settings-group">
            <label for="fontSizeSelect">글꼴 크기</label>
            <select id="fontSizeSelect">
                <option value="12">12px</option>
                <option value="14" selected>14px</option>
                <option value="16">16px</option>
                <option value="18">18px</option>
                <option value="20">20px</option>
            </select>
        </div>
        <div class="settings-group">
            <label for="tabSizeSelect">탭 크기</label>
            <select id="tabSizeSelect">
                <option value="2" selected>2</option>
                <option value="4">4</option>
                <option value="8">8</option>
            </select>
        </div>
        <div class="settings-group">
            <label for="wordWrap">자동 줄바꿈</label>
            <div class="toggle-switch">
                <input type="checkbox" id="wordWrap" checked>
                <span class="toggle-slider"></span>
            </div>
        </div>
        <div class="settings-group">
            <label for="autoComplete">자동 완성</label>
            <div class="toggle-switch">
                <input type="checkbox" id="autoComplete" checked>
                <span class="toggle-slider"></span>
            </div>
        </div>
    </div>
    
    <!-- 단축키 도움말 -->
    <div class="keyboard-shortcuts">
        <span class="close-modal">&times;</span>
        <h2>키보드 단축키</h2>
        
        <div class="shortcut-group">
            <h3>에디터</h3>
            <div class="shortcut-item">
                <span>저장</span>
                <span><span class="key">Ctrl</span> + <span class="key">S</span></span>
            </div>
            <div class="shortcut-item">
                <span>실행 취소</span>
                <span><span class="key">Ctrl</span> + <span class="key">Z</span></span>
            </div>
            <div class="shortcut-item">
                <span>다시 실행</span>
                <span><span class="key">Ctrl</span> + <span class="key">Shift</span> + <span class="key">Z</span></span>
            </div>
            <div class="shortcut-item">
                <span>복사</span>
                <span><span class="key">Ctrl</span> + <span class="key">C</span></span>
            </div>
            <div class="shortcut-item">
                <span>붙여넣기</span>
                <span><span class="key">Ctrl</span> + <span class="key">V</span></span>
            </div>
            <div class="shortcut-item">
                <span>모두 선택</span>
                <span><span class="key">Ctrl</span> + <span class="key">A</span></span>
            </div>
        </div>
        
        <div class="shortcut-group">
            <h3>검색 및 바꾸기</h3>
            <div class="shortcut-item">
                <span>검색</span>
                <span><span class="key">Ctrl</span> + <span class="key">F</span></span>
            </div>
            <div class="shortcut-item">
                <span>바꾸기</span>
                <span><span class="key">Ctrl</span> + <span class="key">H</span></span>
            </div>
            <div class="shortcut-item">
                <span>다음 찾기</span>
                <span><span class="key">F3</span></span>
            </div>
            <div class="shortcut-item">
                <span>이전 찾기</span>
                <span><span class="key">Shift</span> + <span class="key">F3</span></span>
            </div>
        </div>
        
        <div class="shortcut-group">
            <h3>뷰</h3>
            <div class="shortcut-item">
                <span>분할 뷰 토글</span>
                <span><span class="key">Ctrl</span> + <span class="key">\\</span></span>
            </div>
            <div class="shortcut-item">
                <span>미니맵 토글</span>
                <span><span class="key">Ctrl</span> + <span class="key">M</span></span>
            </div>
            <div class="shortcut-item">
                <span>줌 인</span>
                <span><span class="key">Ctrl</span> + <span class="key">+</span></span>
            </div>
            <div class="shortcut-item">
                <span>줌 아웃</span>
                <span><span class="key">Ctrl</span> + <span class="key">-</span></span>
            </div>
        </div>
        
        <div class="shortcut-group">
            <h3>기타</h3>
            <div class="shortcut-item">
                <span>새 파일</span>
                <span><span class="key">Ctrl</span> + <span class="key">N</span></span>
            </div>
            <div class="shortcut-item">
                <span>파일 열기</span>
                <span><span class="key">Ctrl</span> + <span class="key">O</span></span>
            </div>
            <div class="shortcut-item">
                <span>다음 탭</span>
                <span><span class="key">Ctrl</span> + <span class="key">Tab</span></span>
            </div>
            <div class="shortcut-item">
                <span>이전 탭</span>
                <span><span class="key">Ctrl</span> + <span class="key">Shift</span> + <span class="key">Tab</span></span>
            </div>
        </div>
    </div>
    
    <!-- 파일 관리 모달 -->
    <div class="file-modal">
        <span class="close-modal">&times;</span>
        <h2>파일 관리</h2>
        
        <div class="file-input">
            <label for="fileName">파일 이름</label>
            <input type="text" id="fileName" placeholder="파일 이름 입력">
        </div>
        
        <div class="file-actions">
            <button class="cancel" id="cancelSave">취소</button>
            <button class="save" id="confirmSave">저장</button>
        </div>
        
        <div class="saved-files">
            <h3>저장된 파일</h3>
            <div class="file-list" id="fileList">
                <!-- 여기에 저장된 파일 목록이 표시됩니다 -->
            </div>
        </div>
    </div>
    
    <!-- 알림 -->
    <div class="notification" id="notification"></div>
    
    <script>
        // 에디터 초기화 및 설정
        document.addEventListener('DOMContentLoaded', function() {
            // Ace 에디터 초기화
            const editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/handlebars");
            editor.setOptions({
                enableBasicAutocompletion: true,
                enableSnippets: true,
                enableLiveAutocompletion: true,
                fontSize: "14px",
                tabSize: 2,
                useSoftTabs: true,
                wrap: true,
                showPrintMargin: false
            });
            
            // 샘플 코드로 초기화
            const initialCode = `{{#if {{getGlobalVar::toggle_response_mode}}=1}}}}

## Response Template
- Each chapter seamlessly continue from the previous chapter.
- AI's response MUST follow the template below:

- {{#if {{? 1=1}}}}
- {{#if {{? {{getGlobalVar::toggle_response_language}}=1}}{{{{getGlobalVar::response_language}}}}
# Response
{{/if}}{{#if {{? {{getGlobalVar::toggle_response_language}}=1}}}}
# 응답
{{/if}}
{{/if}}

- {{#if {{? 2=2}}}}
- {{#if {{getGlobalVar::toggle_pre}}}}
[Interface/Status Window following the instructions in order]
{{/if}}

- {{#if {{? 3=3}}}}
- {{#if {{getGlobalVar::toggle_help}}}}
- {{#if {{? {{getGlobalVar::toggle_response_language}}=1}}{{{{getGlobalVar::response_language}}}}
#### Input Translation
{{/if}}{{#if {{? {{getGlobalVar::toggle_response_language}}=2}}}}
#### 입력 번역
{{/if}}
{{/if}}`;
            editor.setValue(initialCode, -1);
            
            // 현재 활성 파일 정보
            let currentFile = {
                name: "main.hbs",
                path: "main.hbs",
                saved: true
            };
            updateFileNameDisplay();
            
            // 커서 위치 상태 업데이트
            editor.selection.on('changeCursor', updateCursorPosition);
            
            function updateCursorPosition() {
                const position = editor.getCursorPosition();
                document.getElementById('cursor-position').textContent = `줄: ${position.row + 1}, 열: ${position.column + 1}`;
            }
            
            // 변경 감지
            editor.session.on('change', function() {
                if (currentFile.saved) {
                    currentFile.saved = false;
                    updateFileNameDisplay();
                }
                
                // 미리보기 업데이트 (미리보기가 열려있을 때만)
                if (document.getElementById('previewSection').style.display !== 'none') {
                    updatePreview();
                }
            });
            
            // 파일 이름 표시 업데이트
            function updateFileNameDisplay() {
                const fileNameDisplay = document.querySelector('.file-name-display');
                fileNameDisplay.textContent = currentFile.name + (currentFile.saved ? '' : ' *');
            }
            
            // 미리보기 업데이트
            function updatePreview() {
                const previewElement = document.getElementById('preview');
                const code = editor.getValue();
                previewElement.innerHTML = `<pre>${escapeHtml(code)}</pre>`;
            }
            
            // HTML 이스케이프 함수
            function escapeHtml(text) {
                return text
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            // 검색 패널 토글
            document.getElementById('searchButton').addEventListener('click', function() {
                const searchPanel = document.querySelector('.search-panel');
                searchPanel.classList.toggle('active');
                if (searchPanel.classList.contains('active')) {
                    document.getElementById('searchInput').focus();
                }
            });
            
            // 설정 메뉴 토글
            document.getElementById('settingsButton').addEventListener('click', function() {
                document.querySelector('.settings-menu').classList.toggle('active');
            });
            
            // 단축키 도움말 토글
            document.getElementById('helpButton').addEventListener('click', function() {
                document.querySelector('.keyboard-shortcuts').classList.toggle('active');
            });
            
            // 파일 관리 모달 토글
            document.getElementById('fileManagerButton').addEventListener('click', function() {
                document.querySelector('.file-modal').classList.toggle('active');
                loadSavedFiles();
            });
            
            // 분할 뷰 토글
            document.getElementById('splitViewButton').addEventListener('click', toggleSplitView);
            
            function toggleSplitView() {
                const previewSection = document.getElementById('previewSection');
                if (previewSection.style.display === 'none') {
                    previewSection.style.display = 'flex';
                    updatePreview();
                } else {
                    previewSection.style.display = 'none';
                }
            }
            
            // 미니맵 토글
            let minimapActive = false;
            document.getElementById('minimapToggle').addEventListener('click', function() {
                minimapActive = !minimapActive;
                if (minimapActive) {
                    editor.setOption("showFoldWidgets", true);
                    editor.renderer.setShowGutter(true);
                    editor.setOption("fontSize", "14px");
                } else {
                    editor.setOption("showFoldWidgets", false);
                    editor.setOption("fontSize", "14px");
                }
                showNotification(minimapActive ? "미니맵 활성화" : "미니맵 비활성화", "success");
            });
            
            // 설정 변경 이벤트
            document.getElementById('themeSelect').addEventListener('change', function() {
                editor.setTheme(`ace/theme/${this.value}`);
            });
            
            document.getElementById('fontSizeSelect').addEventListener('change', function() {
                editor.setOption("fontSize", `${this.value}px`);
            });
            
            document.getElementById('tabSizeSelect').addEventListener('change', function() {
                editor.setOption("tabSize", parseInt(this.value));
                document.getElementById('indent-size').textContent = `들여쓰기: ${this.value}`;
            });
            
            document.getElementById('wordWrap').addEventListener('change', function() {
                editor.setOption("wrap", this.checked);
            });
            
            document.getElementById('autoComplete').addEventListener('change', function() {
                editor.setOption("enableLiveAutocompletion", this.checked);
            });
            
            // 검색 기능
            document.getElementById('findButton').addEventListener('click', function() {
                const searchValue = document.getElementById('searchInput').value;
                const options = {
                    backwards: false,
                    wrap: true,
                    caseSensitive: document.getElementById('caseSensitive').checked,
                    wholeWord: document.getElementById('wholeWord').checked,
                    regExp: document.getElementById('regExp').checked
                };
                
                editor.find(searchValue, options);
            });
            
            document.getElementById('replaceButton').addEventListener('click', function() {
                const replaceValue = document.getElementById('replaceInput').value;
                editor.replace(replaceValue);
            });
            
            document.getElementById('replaceAllButton').addEventListener('click', function() {
                const searchValue = document.getElementById('searchInput').value;
                const replaceValue = document.getElementById('replaceInput').value;
                const options = {
                    caseSensitive: document.getElementById('caseSensitive').checked,
                    wholeWord: document.getElementById('wholeWord').checked,
                    regExp: document.getElementById('regExp').checked
                };
                
                editor.replaceAll(replaceValue, options);
            });
            
            // 모달 닫기 버튼
            document.querySelectorAll('.close-modal').forEach(function(button) {
                button.addEventListener('click', function() {
                    this.closest('.keyboard-shortcuts, .file-modal').classList.remove('active');
                });
            });
            
            // 파일 저장
            document.getElementById('saveButton').addEventListener('click', function() {
                if (currentFile.name === "Untitled") {
                    document.querySelector('.file-modal').classList.add('active');
                    document.getElementById('fileName').focus();
                } else {
                    saveCurrentFile();
                }
            });
            
            document.getElementById('confirmSave').addEventListener('click', function() {
                const fileName = document.getElementById('fileName').value.trim() || "Untitled";
                currentFile.name = fileName.endsWith('.hbs') ? fileName : fileName + '.hbs';
                saveCurrentFile();
                document.querySelector('.file-modal').classList.remove('active');
            });
            
            document.getElementById('cancelSave').addEventListener('click', function() {
                document.querySelector('.file-modal').classList.remove('active');
            });
            
            // 저장된 파일 로드
            function loadSavedFiles() {
                const fileList = document.getElementById('fileList');
                fileList.innerHTML = '';
                
                const savedFiles = JSON.parse(localStorage.getItem('handlebarsFiles')) || {};
                
                for (const fileName in savedFiles) {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    const fileNameSpan = document.createElement('span');
                    fileNameSpan.className = 'file-name';
                    fileNameSpan.textContent = fileName;
                    fileNameSpan.addEventListener('click', function() {
                        loadFile(fileName);
                        document.querySelector('.file-modal').classList.remove('active');
                    });
                    
                    const fileActions = document.createElement('div');
                    fileActions.className = 'file-actions-small';
                    
                    const deleteButton = document.createElement('span');
                    deleteButton.className = 'file-action';
                    deleteButton.textContent = '삭제';
                    deleteButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteFile(fileName);
                    });
                    
                    fileActions.appendChild(deleteButton);
                    fileItem.appendChild(fileNameSpan);
                    fileItem.appendChild(fileActions);
                    
                    fileList.appendChild(fileItem);
                }
                
                if (Object.keys(savedFiles).length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.textContent = '저장된 파일이 없습니다.';
                    fileList.appendChild(emptyMessage);
                }
            }
            
            function saveCurrentFile() {
                const content = editor.getValue();
                const savedFiles = JSON.parse(localStorage.getItem('handlebarsFiles')) || {};
                
                savedFiles[currentFile.name] = {
                    content: content,
                    lastModified: new Date().toISOString()
                };
                
                localStorage.setItem('handlebarsFiles', JSON.stringify(savedFiles));
                
                currentFile.saved = true;
                updateFileNameDisplay();
                
                showNotification(`${currentFile.name} 파일이 저장되었습니다.`, 'success');
            }
            
            function loadFile(fileName) {
                const savedFiles = JSON.parse(localStorage.getItem('handlebarsFiles')) || {};
                if (savedFiles[fileName]) {
                    editor.setValue(savedFiles[fileName].content, -1);
                    currentFile.name = fileName;
                    currentFile.saved = true;
                    updateFileNameDisplay();
                    
                    showNotification(`${fileName} 파일을 불러왔습니다.`, 'success');
                }
            }
            
            function deleteFile(fileName) {
                if (confirm(`${fileName} 파일을 삭제하시겠습니까?`)) {
                    const savedFiles = JSON.parse(localStorage.getItem('handlebarsFiles')) || {};
                    
                    if (savedFiles[fileName]) {
                        delete savedFiles[fileName];
                        localStorage.setItem('handlebarsFiles', JSON.stringify(savedFiles));
                        loadSavedFiles();
                        
                        showNotification(`${fileName} 파일이 삭제되었습니다.`, 'success');
                        
                        if (currentFile.name === fileName) {
                            editor.setValue('', -1);
                            currentFile.name = 'Untitled';
                            currentFile.saved = true;
                            updateFileNameDisplay();
                        }
                    }
                }
            }
            
            // 알림 표시
            function showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} active`;
                
                setTimeout(function() {
                    notification.classList.remove('active');
                }, 3000);
            }
            
            // 새 파일 탭 생성 (이 예제에서는 단일 에디터만 사용)
            document.querySelector('.create-tab').addEventListener('click', function() {
                if (!currentFile.saved) {
                    if (confirm("변경 사항을 저장하시겠습니까?")) {
                        saveCurrentFile();
                    }
                }
                
                editor.setValue('', -1);
                currentFile.name = 'Untitled';
                currentFile.saved = true;
                updateFileNameDisplay();
            });
            
            // 탭 닫기
            document.querySelector('.close-tab').addEventListener('click', function() {
                if (!currentFile.saved) {
                    if (confirm("변경 사항을 저장하시겠습니까?")) {
                        saveCurrentFile();
                    }
                }
                
                editor.setValue('', -1);
                currentFile.name = 'Untitled';
                currentFile.saved = true;
                updateFileNameDisplay();
            });
            
            // 키보드 단축키
            document.addEventListener('keydown', function(e) {
                // Ctrl+S: 저장
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    if (currentFile.name === "Untitled") {
                        document.querySelector('.file-modal').classList.add('active');
                        document.getElementById('fileName').focus();
                    } else {
                        saveCurrentFile();
                    }
                }
                
                // Ctrl+F: 검색
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const searchPanel = document.querySelector('.search-panel');
                    searchPanel.classList.add('active');
                    document.getElementById('searchInput').focus();
                }
                
                // Ctrl+\: 분할 뷰 토글
                if (e.ctrlKey && e.key === '\\') {
                    e.preventDefault();
                    toggleSplitView();
                }
                
                // ESC: 모달, 패널 닫기
                if (e.key === 'Escape') {
                    document.querySelector('.search-panel').classList.remove('active');
                    document.querySelector('.settings-menu').classList.remove('active');
                    document.querySelector('.keyboard-shortcuts').classList.remove('active');
                    document.querySelector('.file-modal').classList.remove('active');
                }
            });
            
            // 초기 커서 위치 업데이트
            updateCursorPosition();
            
            // 메뉴 토글
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.querySelector('.settings-menu').classList.toggle('active');
            });
        });
    </script>
</body>
</html>
